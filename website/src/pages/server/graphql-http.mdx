# GraphQL HTTP

[graphql-http](https://github.com/graphql/graphql-http) is the official reference implementation of the [GraphQL over HTTP Protocol](https://graphql.github.io/graphql-over-http/). It is simple, pluggable and zero-dependency server and client.

## Installation

```sh npm2yarn
npm i graphql graphql-http
```

## Schema

### Basic

```ts filename="examples/server/graphql-http/basic.ts"
import { createServer } from 'node:http';
import { createHandler } from 'graphql-http/lib/use/http';
import { buildSchema } from '@database/<database>/schema/basic';

const handler = createHandler({
  schema: await buildSchema(),
});

const server = createServer((req, res) => {
  if (req.url?.startsWith('/graphql')) {
    handler(req, res);
  } else {
    res.writeHead(404).end();
  }
});

server.listen(50005);

console.info('Server is running on http://localhost:50005/graphql');
```

Visit [`http://localhost:50005/graphql`](http://localhost:50005/graphql) to see the server in action.

### Authentication

```ts filename="examples/server/graphql-http/authentication.ts"
import { createServer, IncomingMessage } from 'node:http';
import { createHandler } from 'graphql-http/lib/use/http';
import { sessionIdFromCookie, sessionIdToCookie } from '@server/common';
import { Context } from '@schema/authentication';
import { buildSchema } from '@database/<database>/schema/authentication';

const SESSION_REQUEST_TO_ID_MAP = new WeakMap<IncomingMessage, string>();

const handler = createHandler<Context>({
  schema: await buildSchema(),
  context: (req) => ({
    sessionId: sessionIdFromCookie(req.raw.headers.cookie),
    setSessionId(sessionId) {
      SESSION_REQUEST_TO_ID_MAP.set(req.raw, sessionId);
    },
  }),
});

const server = createServer((req, res) => {
  if (req.url?.startsWith('/graphql')) {
    const sessionId = SESSION_REQUEST_TO_ID_MAP.get(req);
    if (sessionId) {
      res.setHeader('set-cookie', sessionIdToCookie(sessionId));
    }
    handler(req, res);
  } else {
    res.writeHead(404).end();
  }
});

server.listen(50005);

console.info('Server is running on http://localhost:50005/graphql');
```

Visit [`http://localhost:50005/graphql`](http://localhost:50005/graphql) to see the server in action.
